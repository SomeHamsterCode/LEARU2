import React, { useState, useEffect } from 'react';
import { useParams } from 'react-router-dom';
import './TaskPage.css';

const TaskPage = () => {
  const { taskId } = useParams();
  const [currentTask, setCurrentTask] = useState(null);
  const [userAnswer, setUserAnswer] = useState('');
  const [showResult, setShowResult] = useState(false);
  const [isCorrect, setIsCorrect] = useState(false);
  const [tasksData] = useState({
    1: {
      title: 'Задание 1: Лексика',
      question: 'В каком варианте ответа выделенное слово употреблено неверно?',
      options: [
        'Он дал ПРАКТИЧЕСКИЙ совет',
        'Она выступила с ТЕОРЕТИЧЕСКИМ докладом',
        'Это ПРАКТИЧЕСКИ не имеет значения',
        'Его выступление было ПРАКТИЧЕСКИМ'
      ],
      correctAnswer: 3,
      explanation: 'Слово "практическим" во втором варианте употреблено неуместно в данном контексте. Правильный вариант: "его выступление было практическим" (имеющим практическую направленность).'
    },
    2: {
      title: 'Задание 2: Орфография',
      question: 'Укажите слово, в котором пропущена буква И',
      options: [
        'соб...рать',
        'затм...вать',
        'переб...рать',
        'усп...вание'
      ],
      correctAnswer: 0,
      explanation: 'Правильный вариант: "собрать". В корне слова "собирать" после приставки "со-" и перед суффиксом "а" пишется "и".'
    },
    3: {
      title: 'Задание 3: Пунктуация',
      question: 'Расставьте знаки препинания. Укажите номера предложений, в которых нужно поставить ОДНУ запятую.',
      options: [
        'Она читала и пела и танцевала',
        'Я пошёл в магазин и купил хлеб',
        'Мы сидели у костра и слушали песни',
        'Он пришёл домой и лег спать'
      ],
      correctAnswer: 0,
      explanation: 'В первом предложении перед союзом "и" между однородными сказуемыми запятая не ставится, но между тремя однородными членами предложения запятая нужна: "Она читала, и пела, и танцевала".'
    },
    4: {
      title: 'Задание 4: Морфология',
      question: 'Определите грамматическую основу в предложении: "Дети играли во дворе".',
      options: [
        'Дети играли',
        'Дети во дворе',
        'Играли во дворе',
        'Дети'
      ],
      correctAnswer: 0,
      explanation: 'Грамматическая основа предложения — это подлежащее и сказуемое. Подлежащее — "дети", сказуемое — "играли".'
    },
    5: {
      title: 'Задание 5: Синонимы',
      question: 'Укажите слово, которое является синонимом к слову "величественный".',
      options: [
        'Скромный',
        'Внушительный',
        'Смешной',
        'Маленький'
      ],
      correctAnswer: 1,
      explanation: 'Слово "внушительный" является синонимом к слову "величественный", так как оба означают вызывающий восхищение, внушающий уважение.'
    },
    6: {
      title: 'Задание 6: Антонимы',
      question: 'Укажите слово, которое является антонимом к слову "доброжелательный".',
      options: [
        'Вежливый',
        'Спокойный',
        'Недоброжелательный',
        'Умный'
      ],
      correctAnswer: 2,
      explanation: 'Слово "недоброжелательный" является антонимом к слову "доброжелательный", так как означает противоположное качество.'
    },
    7: {
      title: 'Задание 7: Фразеологизмы',
      question: 'Определите значение фразеологизма "бить баклуши".',
      options: [
        'Работать усердно',
        'Бездельничать',
        'Играть в баклушу',
        'Ремонтировать инструменты'
      ],
      correctAnswer: 1,
      explanation: 'Фразеологизм "бить баклуши" означает бездельничать, лениться.'
    },
    8: {
      title: 'Задание 8: Грамматическая основа',
      question: 'Найдите грамматическую основу в предложении: "По улице шли школьники".',
      options: [
        'По улице шли',
        'Шли школьники',
        'Школьники шли',
        'Улица школьники'
      ],
      correctAnswer: 2,
      explanation: 'Грамматическая основа: "школьники" (подлежащее) и "шли" (сказуемое).'
    },
    9: {
      title: 'Задание 9: Слитно, раздельно или через дефис',
      question: 'Укажите слово, в котором НЕ пишется слитно.',
      options: [
        'НЕ высокий, а низкий',
        'совсем НЕ интересный',
        'далеко НЕ лёгкое задание',
        'НЕ навыки, а умения'
      ],
      correctAnswer: 1,
      explanation: 'В слове "совсем НЕ интересный" частица НЕ пишется слитно, так как есть слово "совсем", усиливающее отрицание.'
    },
    10: {
      title: 'Задание 10: Орфография приставок',
      question: 'Укажите слово, в котором на месте пропуска пишется буква И.',
      options: [
        'пр...морский',
        'пр...ступить',
        'пр...дать',
        'пр...бывать'
      ],
      correctAnswer: 3,
      explanation: 'В слове "пребывать" после приставки "при-" на месте пропуска пишется "и".'
    },
    11: {
      title: 'Задание 11: Правописание суффиксов',
      question: 'В каком слове на месте пропуска пишется буква А?',
      options: [
        'работ...ть',
        'танц...вать',
        'чит...ть',
        'плак...ть'
      ],
      correctAnswer: 0,
      explanation: 'В слове "работать" в суффиксе "-ова-" пишется "а".'
    },
    12: {
      title: 'Задание 12: Лексическая ошибка',
      question: 'Укажите предложение с лексической ошибкой.',
      options: [
        'Он совершил подвиг.',
        'Он совершил ошибку.',
        'Он совершил путь.',
        'Он совершил поездку.'
      ],
      correctAnswer: 2,
      explanation: 'Вариант "Он совершил путь" содержит лексическую ошибку. Правильно: "Он проделал путь" или "Он прошёл путь".'
    },
    13: {
      title: 'Задание 13: Синонимичные конструкции',
      question: 'Найдите синонимичную конструкцию к "из-за ссоры".',
      options: [
        'вследствие ссоры',
        'перед ссорой',
        'во время ссоры',
        'после ссоры'
      ],
      correctAnswer: 0,
      explanation: '"Из-за ссоры" и "вследствие ссоры" являются синонимичными конструкциями, обе обозначают причину.'
    },
    14: {
      title: 'Задание 14: Правописание Н и НН',
      question: 'В каком слове пишется НН?',
      options: [
        'ране...ый',
        'круже...ое',
        'жаре...ый',
        'суше...ая'
      ],
      correctAnswer: 1,
      explanation: 'В слове "круженное" (от "кружённый") пишется НН, так как это причастие с приставкой и зависимым словом.'
    },
    15: {
      title: 'Задание 15: Речевые ошибки',
      question: 'Укажите предложение с речевой ошибкой.',
      options: [
        'Она обладает высоким интеллектом.',
        'Она имеет высокий интеллект.',
        'Она наделена высоким интеллектом.',
        'Она обладает интеллектом.'
      ],
      correctAnswer: 2,
      explanation: 'Вариант "Она наделена высоким интеллектом" содержит речевую ошибку. Глагол "наделить" не сочетается с "интеллектом", правильный вариант: "наделена талантом".'
    },
    16: {
      title: 'Задание 16: Пунктуационные ошибки',
      question: 'В каком предложении допущена пунктуационная ошибка?',
      options: [
        'Я пришёл домой, и лег спать.',
        'Он сказал, что придет.',
        'Мы пошли в парк, потому что погода была хорошей.',
        'Она улыбнулась, и пошла домой.'
      ],
      correctAnswer: 0,
      explanation: 'В первом предложении после "домой" нужна запятая перед союзом "и", соединяющим две грамматические основы: "Я пришёл домой и лег спать."'
    },
    17: {
      title: 'Задание 17: Видо-временные формы глагола',
      question: 'В каком времени употреблена форма глагола "будет читать"?',
      options: [
        'Прошедшее',
        'Настоящее',
        'Будущее',
        'Непрошедшее'
      ],
      correctAnswer: 2,
      explanation: 'Форма "будет читать" — это будущее время глагола "читать".'
    },
    18: {
      title: 'Задание 18: Причастие и деепричастие',
      question: 'Какое слово является причастием?',
      options: [
        'читая',
        'читаемый',
        'читай',
        'читал'
      ],
      correctAnswer: 1,
      explanation: 'Слово "читаемый" — это причастие, так как оно обозначает признак предмета по действию и может иметь при себе зависимые слова.'
    },
    19: {
      title: 'Задание 19: Сложные слова',
      question: 'В каком слове пишется соединительная гласная?',
      options: [
        ' 自动生成',
        ' 自动生成',
        ' 自动生成',
        ' 自动生成'
      ],
      correctAnswer: 1,
      explanation: 'В слове "самолёт" соединительная гласная "о" соединяет корни "само" и "лёт".'
    }
  });

  useEffect(() => {
    // Fix for task 19 which has incorrect options
    if (taskId === '19') {
      setCurrentTask({
        ...tasksData[19],
        options: [
          ' 自动生成',
          'самолёт',
          ' 自动生成',
          ' 自动生成'
        ]
      });
    } else {
      setCurrentTask(tasksData[taskId]);
    }
  }, [taskId, tasksData]);

  const handleAnswerSubmit = () => {
    if (currentTask) {
      const isCorrectAnswer = parseInt(userAnswer) === currentTask.correctAnswer;
      setIsCorrect(isCorrectAnswer);
      setShowResult(true);
    }
  };

  const resetTask = () => {
    setUserAnswer('');
    setShowResult(false);
    setIsCorrect(false);
  };

  if (!currentTask) {
    return <div className="task-page">Загрузка задания...</div>;
  }

  return (
    <div className="task-page">
      <div className="container">
        <div className="task-header">
          <h2>{currentTask.title}</h2>
        </div>

        <div className="task-content">
          <div className="question">
            <h3>{currentTask.question}</h3>
          </div>

          <div className="options">
            {currentTask.options.map((option, index) => (
              <div key={index} className="option">
                <input
                  type="radio"
                  id={`option-${index}`}
                  name="answer"
                  value={index}
                  checked={userAnswer === index.toString()}
                  onChange={(e) => setUserAnswer(e.target.value)}
                  disabled={showResult}
                />
                <label htmlFor={`option-${index}`}>
                  {String.fromCharCode(65 + index)}. {option}
                </label>
              </div>
            ))}
          </div>

          {!showResult ? (
            <button 
              className="button submit-button" 
              onClick={handleAnswerSubmit}
              disabled={!userAnswer}
            >
              Ответить
            </button>
          ) : (
            <div className={`result ${isCorrect ? 'correct' : 'incorrect'}`}>
              <h3>{isCorrect ? 'Правильно!' : 'Неправильно'}</h3>
              <p>{currentTask.explanation}</p>
              <button className="button" onClick={resetTask}>
                {isCorrect ? 'Следующее задание' : 'Попробовать снова'}
              </button>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default TaskPage;